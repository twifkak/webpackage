<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Use Cases and Requirements for Web Packages</title>

  
<style type="text/css">/*<![CDATA[*/

body {
  font: 16px "Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 24px;
  margin: 75px auto;
  max-width: 624px;
  padding: 0 5px;
}

.title, .filename, h1, h2, h3, h4, h5 {
  font: 16px "Roboto Condensed","Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  font-size-adjust: 0.5;
  font-weight: bold;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title, #rfc\.title h1 { font-size: 32px; }
h1, section h1, h2, section h2, section h3, nav h2 { font-size: 20px; }
h3, section h4, h4, section h5 { font-size: 16px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header, table#rfc\.headerblock {
  width: 100%;
}
table.header td, table#rfc\.headerblock td {
  border: none;
  background-color: transparent;
  color: black;
  padding: 0;
}
.filename {
  display: block;
  color: rgb(119, 119, 119);
  font-size: 20px;
  font-weight: normal;
  line-height: 100%;
  margin: 10px 0 32px;
}
#rfc\.abstract+p, #rfc\.abstract p {
  font-size: 20px;
  line-height: 28px;
}

samp, tt, code, pre {
  font: 15px Consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure, caption {
  font-style: italic;
  margin: 0 1.5em;
  text-align: left;
}

address {
  margin: 16px 2px;
  line-height: 20px;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn, address b {
  font-weight: normal;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}
hr.noprint {
  display: none;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

ul.toc ul {
  margin: 0 0 0 2em;
}
ul.toc li {
  list-style: none;
  margin: 0;
}

@media screen and (min-width: 924px) {
  body {
    padding-right: 350px;
  }
  body>ul.toc, body>#rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    z-index: 1;
    overflow: auto;
    overscroll-behavior: contain;
  }
  body>#rfc\.toc {
    top: 55px;
  }
  body>ul.toc {
    top: 100px;
  }

  ul.toc {
    margin: 0 0 0 4px;
    font-size: 12px;
    line-height: 20px;
  }
  ul.toc ul {
    margin-left: 1.2em;
  }
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>
  <meta name="viewport" content="initial-scale=1.0">


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Use cases">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Essential">
<link href="#rfc.section.2.1.1" rel="Chapter" title="2.1.1 Offline installation">
<link href="#rfc.section.2.1.2" rel="Chapter" title="2.1.2 Offline browsing">
<link href="#rfc.section.2.1.3" rel="Chapter" title="2.1.3 Save and share a web page">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Nice-to-have">
<link href="#rfc.section.2.2.1" rel="Chapter" title="2.2.1 Packaged Web Publications">
<link href="#rfc.section.2.2.2" rel="Chapter" title="2.2.2 Avoiding Censorship">
<link href="#rfc.section.2.2.3" rel="Chapter" title="2.2.3 Third-party security review">
<link href="#rfc.section.2.2.4" rel="Chapter" title="2.2.4 Building packages from multiple libraries">
<link href="#rfc.section.2.2.5" rel="Chapter" title="2.2.5 Privacy-preserving prefetch">
<link href="#rfc.section.2.2.6" rel="Chapter" title="2.2.6 Cross-CDN Serving">
<link href="#rfc.section.2.2.7" rel="Chapter" title="2.2.7 Installation from a self-extracting executable">
<link href="#rfc.section.2.2.8" rel="Chapter" title="2.2.8 Packages in version control">
<link href="#rfc.section.2.2.9" rel="Chapter" title="2.2.9 Subresource bundling">
<link href="#rfc.section.2.2.10" rel="Chapter" title="2.2.10 Archival">
<link href="#rfc.section.3" rel="Chapter" title="3 Requirements">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Essential">
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 Indexed by URL">
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 Request headers">
<link href="#rfc.section.3.1.3" rel="Chapter" title="3.1.3 Response headers">
<link href="#rfc.section.3.1.4" rel="Chapter" title="3.1.4 Signing as an origin">
<link href="#rfc.section.3.1.5" rel="Chapter" title="3.1.5 Random access">
<link href="#rfc.section.3.1.6" rel="Chapter" title="3.1.6 Resources from multiple origins in a package">
<link href="#rfc.section.3.1.7" rel="Chapter" title="3.1.7 Cryptographic agility">
<link href="#rfc.section.3.1.8" rel="Chapter" title="3.1.8 Unsigned content">
<link href="#rfc.section.3.1.9" rel="Chapter" title="3.1.9 Certificate revocation">
<link href="#rfc.section.3.1.10" rel="Chapter" title="3.1.10 Downgrade prevention">
<link href="#rfc.section.3.1.11" rel="Chapter" title="3.1.11 Metadata">
<link href="#rfc.section.3.1.12" rel="Chapter" title="3.1.12 Implementations are hard to get wrong">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Nice to have">
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 Streamed loading">
<link href="#rfc.section.3.2.2" rel="Chapter" title="3.2.2 Additional signatures">
<link href="#rfc.section.3.2.3" rel="Chapter" title="3.2.3 Binary">
<link href="#rfc.section.3.2.4" rel="Chapter" title="3.2.4 Deduplication of diamond dependencies">
<link href="#rfc.section.3.2.5" rel="Chapter" title="3.2.5 Old crypto can be removed">
<link href="#rfc.section.3.2.6" rel="Chapter" title="3.2.6 Compress transfers">
<link href="#rfc.section.3.2.7" rel="Chapter" title="3.2.7 Compress stored packages">
<link href="#rfc.section.3.2.8" rel="Chapter" title="3.2.8 Subsetting and reordering">
<link href="#rfc.section.3.2.9" rel="Chapter" title="3.2.9 Packaged validity information">
<link href="#rfc.section.3.2.10" rel="Chapter" title="3.2.10 Signing uses existing TLS certificates">
<link href="#rfc.section.3.2.11" rel="Chapter" title="3.2.11 External dependencies">
<link href="#rfc.section.3.2.12" rel="Chapter" title="3.2.12 Trailing length">
<link href="#rfc.section.3.2.13" rel="Chapter" title="3.2.13 Time-shifting execution">
<link href="#rfc.section.4" rel="Chapter" title="4 Non-goals">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Store confidential data">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Generate packages on the fly">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Non-origin identity">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 DRM">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Ergonomic replacement for HTTP/2 PUSH">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="7 Informative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Acknowledgements">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.9.8 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Yasskin, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-yasskin-webpackage-use-cases-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2018-06-20" />
  <meta name="dct.abstract" content="This document lists use cases for signing and/or bundling collections of web pages, and extracts a set of requirements from them." />
  <meta name="description" content="This document lists use cases for signing and/or bundling collections of web pages, and extracts a set of requirements from them." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">J. Yasskin</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Google</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">June 20, 2018</td>
</tr>
<tr>
<td class="left">Expires: December 22, 2018</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Use Cases and Requirements for Web Packages<br />
  <span class="filename">draft-yasskin-webpackage-use-cases-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document lists use cases for signing and/or bundling collections of web pages, and extracts a set of requirements from them.</p>
<h1><a>Note to Readers</a></h1>
<p>Discussion of this draft takes place on the ART area mailing list (art@ietf.org), which is archived at <a href="https://mailarchive.ietf.org/arch/search/?email_list=art">https://mailarchive.ietf.org/arch/search/?email_list=art</a>.</p>
<p>The source code and issues list for this draft can be found in <a href="https://github.com/WICG/webpackage">https://github.com/WICG/webpackage</a>.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 22, 2018.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2018 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Use cases</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Essential</a>
</li>
<ul><li>2.1.1.   <a href="#rfc.section.2.1.1">Offline installation</a>
</li>
<li>2.1.2.   <a href="#rfc.section.2.1.2">Offline browsing</a>
</li>
<li>2.1.3.   <a href="#rfc.section.2.1.3">Save and share a web page</a>
</li>
</ul><li>2.2.   <a href="#rfc.section.2.2">Nice-to-have</a>
</li>
<ul><li>2.2.1.   <a href="#rfc.section.2.2.1">Packaged Web Publications</a>
</li>
<li>2.2.2.   <a href="#rfc.section.2.2.2">Avoiding Censorship</a>
</li>
<li>2.2.3.   <a href="#rfc.section.2.2.3">Third-party security review</a>
</li>
<li>2.2.4.   <a href="#rfc.section.2.2.4">Building packages from multiple libraries</a>
</li>
<li>2.2.5.   <a href="#rfc.section.2.2.5">Privacy-preserving prefetch</a>
</li>
<li>2.2.6.   <a href="#rfc.section.2.2.6">Cross-CDN Serving</a>
</li>
<li>2.2.7.   <a href="#rfc.section.2.2.7">Installation from a self-extracting executable</a>
</li>
<li>2.2.8.   <a href="#rfc.section.2.2.8">Packages in version control</a>
</li>
<li>2.2.9.   <a href="#rfc.section.2.2.9">Subresource bundling</a>
</li>
<li>2.2.10.   <a href="#rfc.section.2.2.10">Archival</a>
</li>
</ul></ul><li>3.   <a href="#rfc.section.3">Requirements</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Essential</a>
</li>
<ul><li>3.1.1.   <a href="#rfc.section.3.1.1">Indexed by URL</a>
</li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">Request headers</a>
</li>
<li>3.1.3.   <a href="#rfc.section.3.1.3">Response headers</a>
</li>
<li>3.1.4.   <a href="#rfc.section.3.1.4">Signing as an origin</a>
</li>
<li>3.1.5.   <a href="#rfc.section.3.1.5">Random access</a>
</li>
<li>3.1.6.   <a href="#rfc.section.3.1.6">Resources from multiple origins in a package</a>
</li>
<li>3.1.7.   <a href="#rfc.section.3.1.7">Cryptographic agility</a>
</li>
<li>3.1.8.   <a href="#rfc.section.3.1.8">Unsigned content</a>
</li>
<li>3.1.9.   <a href="#rfc.section.3.1.9">Certificate revocation</a>
</li>
<li>3.1.10.   <a href="#rfc.section.3.1.10">Downgrade prevention</a>
</li>
<li>3.1.11.   <a href="#rfc.section.3.1.11">Metadata</a>
</li>
<li>3.1.12.   <a href="#rfc.section.3.1.12">Implementations are hard to get wrong</a>
</li>
</ul><li>3.2.   <a href="#rfc.section.3.2">Nice to have</a>
</li>
<ul><li>3.2.1.   <a href="#rfc.section.3.2.1">Streamed loading</a>
</li>
<li>3.2.2.   <a href="#rfc.section.3.2.2">Additional signatures</a>
</li>
<li>3.2.3.   <a href="#rfc.section.3.2.3">Binary</a>
</li>
<li>3.2.4.   <a href="#rfc.section.3.2.4">Deduplication of diamond dependencies</a>
</li>
<li>3.2.5.   <a href="#rfc.section.3.2.5">Old crypto can be removed</a>
</li>
<li>3.2.6.   <a href="#rfc.section.3.2.6">Compress transfers</a>
</li>
<li>3.2.7.   <a href="#rfc.section.3.2.7">Compress stored packages</a>
</li>
<li>3.2.8.   <a href="#rfc.section.3.2.8">Subsetting and reordering</a>
</li>
<li>3.2.9.   <a href="#rfc.section.3.2.9">Packaged validity information</a>
</li>
<li>3.2.10.   <a href="#rfc.section.3.2.10">Signing uses existing TLS certificates</a>
</li>
<li>3.2.11.   <a href="#rfc.section.3.2.11">External dependencies</a>
</li>
<li>3.2.12.   <a href="#rfc.section.3.2.12">Trailing length</a>
</li>
<li>3.2.13.   <a href="#rfc.section.3.2.13">Time-shifting execution</a>
</li>
</ul></ul><li>4.   <a href="#rfc.section.4">Non-goals</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Store confidential data</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Generate packages on the fly</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Non-origin identity</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">DRM</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Ergonomic replacement for HTTP/2 PUSH</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">IANA Considerations</a>
</li>
<li>7.   <a href="#rfc.references">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.A">Acknowledgements</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">People would like to use content offline and in other situations where there isn&#8217;t a direct connection to the server where the content originates. However, it&#8217;s difficult to distribute and verify the authenticity of applications and content without a connection to the network. The W3C has addressed running applications offline with Service Workers (<a href="#ServiceWorkers" class="xref">[ServiceWorkers]</a>), but not the problem of distribution.</p>
<p id="rfc.section.1.p.2">Previous attempts at packaging web resources (e.g.  <a href="https://www.mnot.net/blog/2010/02/18/resource_packages">Resource Packages</a> and the <a href="https://w3ctag.github.io/packaging-on-the-web/">W3C TAG&#8217;s packaging proposal</a>) were motivated by speeding up the download of resources from a single server, which is probably better achieved through other mechanisms like HTTP/2 PUSH, possibly augmented with a <a href="https://lists.w3.org/Archives/Public/public-web-perf/2015Jan/0038.html">simple manifest of URLs a page plans to use</a>.  This attempt is instead motivated by avoiding a connection to the origin server at all. It may still be useful for the earlier use cases, so they&#8217;re still listed, but they&#8217;re not primary.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#use-cases" id="use-cases">Use cases</a>
</h1>
<p id="rfc.section.2.p.1">These use cases are in rough descending priority order. If use cases have conflicting requirements, the design should enable more important use cases.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#essential-use-cases" id="essential-use-cases">Essential</a>
</h1>
<h1 id="rfc.section.2.1.1">
<a href="#rfc.section.2.1.1">2.1.1.</a> <a href="#offline-installation" id="offline-installation">Offline installation</a>
</h1>
<p id="rfc.section.2.1.1.p.1">Alex can download a file containing a website (a <a href="https://developers.google.com/web/progressive-web-apps/checklist">PWA</a>) including a Service Worker from origin <samp>O</samp>, and transmit it to their peer Bailey, and then Bailey can install the Service Worker with a proof that it came from <samp>O</samp>.  This saves Bailey the bandwidth costs of transferring the website.</p>
<p id="rfc.section.2.1.1.p.2">There are roughly two ways to accomplish this:</p>
<p></p>

<ol>
<li>Package just the Service Worker Javascript and any other Javascript that it <a href="https://w3c.github.io/ServiceWorker/#importscripts">importScripts()</a>, with their URLs and enough metadata to synthesize a <a href="https://w3c.github.io/ServiceWorker/#navigator-service-worker-register">navigator.serviceWorker.register(scriptURL, options) call</a>, along with an uninterpreted but signature-checked blob of data that the Service Worker can interpret to fill in its caches.</li>
<li>Package the resources so that the Service Worker can fetch() them to populate its cache.</li>
</ol>
<p id="rfc.section.2.1.1.p.4">Associated requirements for just the Service Worker:</p>
<p></p>

<ul>
<li>
<a href="#urls" class="xref">Indexed by URL</a>: The <samp>register()</samp> and <samp>importScripts()</samp> calls have semantics that depend on the URL.</li>
<li>
<a href="#signing" class="xref">Signing as an origin</a>: To prove that the file came from <samp>O</samp>.</li>
<li>
<a href="#existing-certs" class="xref">Signing uses existing TLS certificates</a>: So <samp>O</samp> doesn&#8217;t have to spend lots of money buying a specialized certificate.</li>
<li>
<a href="#crypto-agility" class="xref">Cryptographic agility</a>: Today&#8217;s algorithms will eventually be obsolete and will need to be replaced.</li>
<li>
<a href="#revocation" class="xref">Certificate revocation</a>: <samp>O</samp>&#8217;s certificate might be compromised or mis-issued, and the attacker shouldn&#8217;t then get an infinite ability to mint packages.</li>
<li>
<a href="#no-downgrades" class="xref">Downgrade prevention</a>: <samp>O</samp>&#8217;s site might have an XSS vulnerability, and attackers with an old signed package shouldn&#8217;t be able to take advantage of the XSS forever.</li>
<li>
<a href="#metadata" class="xref">Metadata</a>: Just enough to generate the <samp>register()</samp> call, which is less than a full W3C Application Manifest.</li>
</ul>
<p id="rfc.section.2.1.1.p.6">Additional associated requirements for packaged resources:</p>
<p></p>

<ul>
<li>
<a href="#urls" class="xref">Indexed by URL</a>: Resources on the web are addressed by URL.</li>
<li>
<a href="#request-headers" class="xref">Request headers</a>: If Bailey&#8217;s running a different browser from Alex or has a different language configured, the <samp>accept*</samp> headers are important for selecting which resource to use at each URL.</li>
<li>
<a href="#response-headers" class="xref">Response headers</a>: The meaning of a resource is heavily influenced by its HTTP response headers.</li>
<li>
<a href="#multiple-origins" class="xref">Resources from multiple origins in a package</a>: So the site can be <a href="#libraries" class="xref">built from multiple components</a>.</li>
<li>
<a href="#metadata" class="xref">Metadata</a>: The browser needs to know which resource within a package file to treat as its Service Worker and/or initial HTML page.</li>
</ul>
<h1 id="rfc.section.2.1.1.1">
<a href="#rfc.section.2.1.1.1">2.1.1.1.</a> <a href="#online-use" id="online-use">Online use</a>
</h1>
<p id="rfc.section.2.1.1.1.p.1">Bailey may have an internet connection through which they can, in real time, fetch updates to the package they received from Alex.</p>
<h1 id="rfc.section.2.1.1.2">
<a href="#rfc.section.2.1.1.2">2.1.1.2.</a> <a href="#fully-offline-use" id="fully-offline-use">Fully offline use</a>
</h1>
<p id="rfc.section.2.1.1.2.p.1">Or Bailey may not have any internet connection a significant fraction of the time, either because they have no internet at all, because they turn off internet except when intentionally downloading content, or because they use up their plan partway through each month.</p>
<p id="rfc.section.2.1.1.2.p.2">Associated requirements beyond <a href="#offline-installation" class="xref">Offline installation</a>:</p>
<p></p>

<ul><li>
<a href="#packaged-validity" class="xref">Packaged validity information</a>: Even without a direct internet connection, Bailey should be able to check that their package is still valid.</li></ul>
<h1 id="rfc.section.2.1.2">
<a href="#rfc.section.2.1.2">2.1.2.</a> <a href="#offline-browsing" id="offline-browsing">Offline browsing</a>
</h1>
<p id="rfc.section.2.1.2.p.1">Alex can download a file containing a large website (e.g. Wikipedia) from its origin, save it to transferrable storage (e.g. an SD card), and hand it to their peer Bailey. Then Bailey can browse the website with a proof that it came from <samp>O</samp>. Bailey may not have the storage space to copy the website before browsing it.</p>
<p id="rfc.section.2.1.2.p.2">This use case is harder for publishers to support if we specialize <a href="#offline-installation" class="xref">Section 2.1.1</a> for Service Workers since it requires the publisher to adopt Service Workers before they can sign their site.</p>
<p id="rfc.section.2.1.2.p.3">Associated requirements beyond <a href="#offline-installation" class="xref">Offline installation</a>:</p>
<p></p>

<ul>
<li>
<a href="#random-access" class="xref">Random access</a>: To avoid needing a long linear scan before using the content.</li>
<li>
<a href="#stored-compression" class="xref">Compress stored packages</a>: So that more content can fit on the same storage device.</li>
</ul>
<h1 id="rfc.section.2.1.3">
<a href="#rfc.section.2.1.3">2.1.3.</a> <a href="#snapshot" id="snapshot">Save and share a web page</a>
</h1>
<p id="rfc.section.2.1.3.p.1">Casey is viewing a web page and wants to save it either for offline use or to show it to their friend Dakota. Since Casey isn&#8217;t the web page&#8217;s publisher, they don&#8217;t have the private key needed to sign the page. Browsers currently allow their users to save pages, but each browser uses a different format (MHTML, Web Archive, or files in a directory), so Dakota and Casey would need to be using the same browser. Casey could also take a screenshot, at the cost of losing links and accessibility.</p>
<p id="rfc.section.2.1.3.p.2">Associated requirements:</p>
<p></p>

<ul>
<li>
<a href="#unsigned-content" class="xref">Unsigned content</a>: A client can&#8217;t sign content as another origin.</li>
<li>
<a href="#multiple-origins" class="xref">Resources from multiple origins in a package</a>: General web pages include resources from multiple origins.</li>
<li>
<a href="#urls" class="xref">Indexed by URL</a>: Resources on the web are addressed by URL.</li>
<li>
<a href="#response-headers" class="xref">Response headers</a>: The meaning of a resource is heavily influenced by its HTTP response headers.</li>
</ul>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#nice-to-have-use-cases" id="nice-to-have-use-cases">Nice-to-have</a>
</h1>
<h1 id="rfc.section.2.2.1">
<a href="#rfc.section.2.2.1">2.2.1.</a> <a href="#uc-web-pub" id="uc-web-pub">Packaged Web Publications</a>
</h1>
<p id="rfc.section.2.2.1.p.1">The <a href="https://www.w3.org/publishing/groups/publ-wg/">W3C&#8217;s Publishing Working Group</a>, merged from the International Digital Publishing Forum (IDPF) and in charge of EPUB maintenance, wants to be able to create publications on the web and then let them be copied to different servers or to other users via arbitrary protocols. See their <a href="https://www.w3.org/TR/pwp-ucr/#pwp">Packaged Web Publications use cases</a> for more details.</p>
<p id="rfc.section.2.2.1.p.2">Associated requirements:</p>
<p></p>

<ul>
<li>
<a href="#urls" class="xref">Indexed by URL</a>: Resources on the web are addressed by URL.</li>
<li>
<a href="#signing" class="xref">Signing as an origin</a>: So that readers can be sure their copy is authentic and so that copying the package preserves the URLs of the content inside it.</li>
<li>
<a href="#no-downgrades" class="xref">Downgrade prevention</a>: An early version of a publication might contain incorrect content, and a publisher should be able to update that without worrying that an attacker can still show the old content to users.</li>
<li>
<a href="#metadata" class="xref">Metadata</a>: A publication can have copyright and licensing concerns; a title, author, and cover image; an ISBN or DOI name; etc.; which should be included when that publication is packaged.</li>
</ul>
<p id="rfc.section.2.2.1.p.4">Other requirements are similar to those from <a href="#offline-installation" class="xref">Offline installation</a>:</p>
<p></p>

<ul>
<li>
<a href="#random-access" class="xref">Random access</a>: To avoid needing a long linear scan before using the content.</li>
<li>
<a href="#stored-compression" class="xref">Compress stored packages</a>: So that more content can fit on the same storage device.</li>
<li>
<a href="#request-headers" class="xref">Request headers</a>: If different users&#8217; browsers have different capabilities or preferences, the <samp>accept*</samp> headers are important for selecting which resource to use at each URL.</li>
<li>
<a href="#response-headers" class="xref">Response headers</a>: The meaning of a resource is heavily influenced by its HTTP response headers.</li>
<li>
<a href="#existing-certs" class="xref">Signing uses existing TLS certificates</a>: So a publisher doesn&#8217;t have to spend lots of money buying a specialized certificate.</li>
<li>
<a href="#crypto-agility" class="xref">Cryptographic agility</a>: Today&#8217;s algorithms will eventually be obsolete and will need to be replaced.</li>
<li>
<a href="#revocation" class="xref">Certificate revocation</a>: The publisher&#8217;s certificate might be compromised or mis-issued, and an attacker shouldn&#8217;t then get an infinite ability to mint packages.</li>
</ul>
<h1 id="rfc.section.2.2.2">
<a href="#rfc.section.2.2.2">2.2.2.</a> <a href="#anti-censorship" id="anti-censorship">Avoiding Censorship</a>
</h1>
<p id="rfc.section.2.2.2.p.1">Some users want to retrieve resources that their governments or network providers don&#8217;t want them to see. Right now, it&#8217;s straightforward for someone in a privileged network position to block access to particular hosts, but TLS makes it difficult to block access to particular resources on those hosts.</p>
<p id="rfc.section.2.2.2.p.2">Today it&#8217;s straightforward to retrieve blocked content from a third party, but there&#8217;s no guarantee that the third-party has sent the user an accurate representation of the content: the user has to trust the third party.</p>
<p id="rfc.section.2.2.2.p.3">With signed web packages, the user can re-gain assurance that the content is authentic, while still bypassing the censorship. Packages don&#8217;t do anything to help discover this content.</p>
<p id="rfc.section.2.2.2.p.4">Systems that make censorship more difficult can also make legitimate content filtering more difficult. Because the client that processes a web package always knows the true URL, this forces content filtering to happen on the client instead of on the network.</p>
<p id="rfc.section.2.2.2.p.5">Associated requirements:</p>
<p></p>

<ul>
<li>
<a href="#urls" class="xref">Indexed by URL</a>: So the user can see that they&#8217;re getting the content they expected.</li>
<li>
<a href="#signing" class="xref">Signing as an origin</a>: So that readers can be sure their copy is authentic and so that copying the package preserves the URLs of the content inside it.</li>
</ul>
<h1 id="rfc.section.2.2.3">
<a href="#rfc.section.2.2.3">2.2.3.</a> <a href="#security-review" id="security-review">Third-party security review</a>
</h1>
<p id="rfc.section.2.2.3.p.1">Some users may want to grant certain permissions only to applications that have been reviewed for security by a trusted third party. These third parties could provide guarantees similar to those provided by the iOS, Android, or Chrome OS app stores, which might allow browsers to offer more powerful capabilities than have been deemed safe for unaudited websites.</p>
<p id="rfc.section.2.2.3.p.2">Binary transparency for websites is similar: like with Certificate Transparency <a href="#RFC6962" class="xref">[RFC6962]</a>, the transparency logs would sign the content of the package to provide assurance that experts had a chance to audit the exact package a client received.</p>
<p id="rfc.section.2.2.3.p.3">Associated requirements:</p>
<p></p>

<ul><li><a href="#additional-signatures" class="xref">Additional signatures</a></li></ul>
<h1 id="rfc.section.2.2.4">
<a href="#rfc.section.2.2.4">2.2.4.</a> <a href="#libraries" id="libraries">Building packages from multiple libraries</a>
</h1>
<p id="rfc.section.2.2.4.p.1">Large programs are built from smaller components. In the case of the web, components can be included either as Javascript files or as <samp>&lt;iframe&gt;</samp>d subresources. In the first case, the packager could copy the JS files to their own origin; but in the second, it may be important for the <samp>&lt;iframe&gt;</samp>d resources to be able to make <a href="https://html.spec.whatwg.org/multipage/origin.html#same-origin">same-origin</a> requests back to their own origin, for example to implement federated sign-in.</p>
<p id="rfc.section.2.2.4.p.2">Associated requirements:</p>
<p></p>

<ul>
<li>
<a href="#multiple-origins" class="xref">Resources from multiple origins in a package</a>: Each component may come from its own origin.</li>
<li>
<a href="#deduplication" class="xref">Deduplication of diamond dependencies</a>: If we have dependencies A-&gt;B-&gt;D and A-&gt;C-&gt;D, it&#8217;s important that a request for a D resource resolves to a single resource that both B and C can handle.</li>
</ul>
<h1 id="rfc.section.2.2.4.1">
<a href="#rfc.section.2.2.4.1">2.2.4.1.</a> <a href="#shared-libraries" id="shared-libraries">Shared libraries</a>
</h1>
<p id="rfc.section.2.2.4.1.p.1">In ecosystems like <a href="https://electron.atom.io/">Electron</a> and <a href="https://nodejs.org/en/">Node</a>, many packages may share some common dependencies. The cost of downloading each package can be greatly reduced if the package can merely point at other dependencies to download instead of including them all inline.</p>
<p id="rfc.section.2.2.4.1.p.2">Associated requirements:</p>
<p></p>

<ul><li><a href="#external-dependencies" class="xref">External dependencies</a></li></ul>
<h1 id="rfc.section.2.2.5">
<a href="#rfc.section.2.2.5">2.2.5.</a> <a href="#private-prefetch" id="private-prefetch">Privacy-preserving prefetch</a>
</h1>
<p id="rfc.section.2.2.5.p.1">Lots of websites link to other websites. Many of these source sites would like the targets of these links to load quickly. The source could use <samp>&lt;link rel="prefetch"&gt;</samp> to prefetch the target of a link, but if the user doesn&#8217;t actually click that link, that leaks the fact that the user saw a page that linked to the target. This can be true even if the prefetch is made without browser credentials because of mechanisms like TLS session IDs.</p>
<p id="rfc.section.2.2.5.p.2">Because clients have limited data budgets to prefetch link targets, this use case is probably limited to sites that can accurately predict which link their users are most likely to click. For example, search engines can predict that their users will click one of the first couple results, and news aggreggation sites like Reddit or Slashdot can hope that users will read the article if they&#8217;ve navigated to its discussion.</p>
<p id="rfc.section.2.2.5.p.3">Two search engines have built systems to do this with today&#8217;s technology: Google&#8217;s <a href="https://www.ampproject.org/">AMP</a> and Baidu&#8217;s <a href="https://www.mipengine.org/">MIP</a> formats and caches allow them to prefetch search results while preserving privacy, at the cost of showing the wrong URLs for the results once the user has clicked. A good solution to this problem would show the right URLs but still avoid a request to the publishing origin until after the user clicks.</p>
<p id="rfc.section.2.2.5.p.4">Associated requirements:</p>
<p></p>

<ul>
<li>
<a href="#signing" class="xref">Signing as an origin</a>: To prove the content came from the original origin.</li>
<li>
<a href="#streamed-loading" class="xref">Streamed loading</a>: If the user clicks before the target page is fully transferred, the browser should be able to start loading early parts before the source site finishes sending the whole page.</li>
<li><a href="#transfer-compression" class="xref">Compress transfers</a></li>
<li>
<a href="#subsetting" class="xref">Subsetting and reordering</a>: If a prefetched page includes subresources, its publisher might want to provide and sign both WebP and PNG versions of an image, but the source site should be able to transfer only best one for each client.</li>
</ul>
<h1 id="rfc.section.2.2.6">
<a href="#rfc.section.2.2.6">2.2.6.</a> <a href="#cross-cdn-serving" id="cross-cdn-serving">Cross-CDN Serving</a>
</h1>
<p id="rfc.section.2.2.6.p.1">When a web page has subresources from a different origin, retrieval of those subresources can be optimized if they&#8217;re transferred over the same connection as the main resource. If both origins are distributed by the same CDN, in-progress mechanisms like <a href="#I-D.ietf-httpbis-http2-secondary-certs" class="xref">[I-D.ietf-httpbis-http2-secondary-certs]</a> allow the server to use a single connection to send both resources, but if the resource and subresource don&#8217;t share a CDN or don&#8217;t use a CDN at all, existing mechanisms don&#8217;t help.</p>
<p id="rfc.section.2.2.6.p.2">If the subresource is signed by its publisher, the main resource&#8217;s server can forward it to the client.</p>
<p id="rfc.section.2.2.6.p.3">There are some yet-to-be-solved privacy problems if the client and server want to avoid transferring subresources that are already in the client&#8217;s cache: naively telling the server that a resource is already present is a privacy leak.</p>
<p id="rfc.section.2.2.6.p.4">Associated requirements:</p>
<p></p>

<ul>
<li>
<a href="#streamed-loading" class="xref">Streamed loading</a>: To get optimal performance, the browser should be able to start loading early parts of a resource before the distributor finishes sending the whole resource.</li>
<li>
<a href="#signing" class="xref">Signing as an origin</a>: To prove the content came from the original origin.</li>
<li><a href="#transfer-compression" class="xref">Compress transfers</a></li>
</ul>
<h1 id="rfc.section.2.2.7">
<a href="#rfc.section.2.2.7">2.2.7.</a> <a href="#self-extracting" id="self-extracting">Installation from a self-extracting executable</a>
</h1>
<p id="rfc.section.2.2.7.p.1">The Node and Electron communities would like to install packages using self-extracting executables. The traditional way to design a self-extracting executable is to concatenate the package to the end of the executable, have the executable look for a length at its own end, and seek backwards from there for the start of the package.</p>
<p id="rfc.section.2.2.7.p.2">Associated requirements:</p>
<p></p>

<ul><li><a href="#trailing-length" class="xref">Trailing length</a></li></ul>
<h1 id="rfc.section.2.2.8">
<a href="#rfc.section.2.2.8">2.2.8.</a> <a href="#version-control" id="version-control">Packages in version control</a>
</h1>
<p id="rfc.section.2.2.8.p.1">Once packages are generated, they should be stored in version control. Many popular VC systems auto-detect text files in order to &#8220;fix&#8221; their line endings.  If the first bytes of a package look like text, while later bytes store binary data, VC may break the package.</p>
<p id="rfc.section.2.2.8.p.2">Associated requirements:</p>
<p></p>

<ul><li><a href="#binary" class="xref">Binary</a></li></ul>
<h1 id="rfc.section.2.2.9">
<a href="#rfc.section.2.2.9">2.2.9.</a> <a href="#bundling" id="bundling">Subresource bundling</a>
</h1>
<p id="rfc.section.2.2.9.p.1">Text based subresources often benefit from improved compression ratios when bundled together.</p>
<p id="rfc.section.2.2.9.p.2">At the same time, the current practice of JS and CSS bundling, by compiling everything into a single JS file, also has negative side-effects:</p>
<p></p>

<ol>
<li>Dependent execution - in order to start executing <em>any</em> of the bundled resources, it is required to download, parse and execute <em>all</em> of them.</li>
<li>Loss of caching granularity - Modification of <em>any</em> of the resources results in caching invalidation of <em>all</em> of them.</li>
<li>Loss of module semantics - ES6 modules must be delivered as independent resources. Therefore, current bundling methods, which deliver them with other resources under a common URL, require transpilation to ES5 and result in loss of ES6 module semantics.</li>
</ol>
<p id="rfc.section.2.2.9.p.4">An on-the-fly readable packaging format, that will enable resources to maintain their own URLs while being physically delivered with other resources, can resolve the above downsides while keeping the upsides of improved compression ratios.</p>
<p id="rfc.section.2.2.9.p.5">To improve cache granularity, the client needs to tell the server which versions of which resources are already cached, which it could do with a Service Worker or perhaps with <a href="#I-D.ietf-httpbis-cache-digest" class="xref">[I-D.ietf-httpbis-cache-digest]</a>.</p>
<p id="rfc.section.2.2.9.p.6">Associated requirements:</p>
<p></p>

<ul>
<li><a href="#urls" class="xref">Indexed by URL</a></li>
<li>
<a href="#streamed-loading" class="xref">Streamed loading</a>: To solve downside 1.</li>
<li>
<a href="#transfer-compression" class="xref">Compress transfers</a>: To keep the upside.</li>
<li>
<a href="#response-headers" class="xref">Response headers</a>: At least the Content-Type is needed to load JS and CSS.</li>
<li>
<a href="#unsigned-content" class="xref">Unsigned content</a>: Signing same-origin content wastes space.</li>
</ul>
<h1 id="rfc.section.2.2.10">
<a href="#rfc.section.2.2.10">2.2.10.</a> <a href="#archival" id="archival">Archival</a>
</h1>
<p id="rfc.section.2.2.10.p.1">Existing formats like WARC (<a href="#ISO28500" class="xref">[ISO28500]</a>) do a good job of accurately representing the state of a web server at a particular time, but a browser can&#8217;t currently use them to give a person the experience of that website at the time it was archived. It&#8217;s not obvious to the author of this draft that a new packaging format is likely to improve on WARC, compared to, for example, implementing support for WARC in browsers, but folks who know about archiving seem interested, e.g.: <a href="https://twitter.com/anjacks0n/status/950861384266416134">https://twitter.com/anjacks0n/status/950861384266416134</a>.</p>
<p id="rfc.section.2.2.10.p.2">Because of the time scales involved in archival, any signatures from the original host would likely not be trusted anymore by the time the archive is viewed, so implementations would need to sandbox the content instead of running it on the original origin.</p>
<p id="rfc.section.2.2.10.p.3">Associated requirements:</p>
<p></p>

<ul>
<li><a href="#urls" class="xref">Indexed by URL</a></li>
<li>
<a href="#response-headers" class="xref">Response headers</a>: To accurately record the server&#8217;s response.</li>
<li>
<a href="#unsigned-content" class="xref">Unsigned content</a>: To deal with expired signatures.</li>
<li><a href="#timeshifting" class="xref">Time-shifting execution</a></li>
</ul>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#requirements" id="requirements">Requirements</a>
</h1>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#essential-reqs" id="essential-reqs">Essential</a>
</h1>
<h1 id="rfc.section.3.1.1">
<a href="#rfc.section.3.1.1">3.1.1.</a> <a href="#urls" id="urls">Indexed by URL</a>
</h1>
<p id="rfc.section.3.1.1.p.1">Resources should be keyed by URLs, matching how browsers look resources up over HTTP.</p>
<h1 id="rfc.section.3.1.2">
<a href="#rfc.section.3.1.2">3.1.2.</a> <a href="#request-headers" id="request-headers">Request headers</a>
</h1>
<p id="rfc.section.3.1.2.p.1">Resource keys should include request headers like <samp>accept</samp> and <samp>accept-language</samp>, which allows content-negotiated resources to be represented.</p>
<p id="rfc.section.3.1.2.p.2">This would require an extension to <a href="#MHTML" class="xref">[MHTML]</a>, which uses the <samp>content-location</samp> response header to encode the requested URL, but has no way to encode other request headers. MHTML also has no instructions for handling multiple resources with the same <samp>content-location</samp>.</p>
<p id="rfc.section.3.1.2.p.3">This also requires an extension to <a href="#ZIP" class="xref">[ZIP]</a>: we&#8217;d need to encode the request headers into ZIP&#8217;s filename fields.</p>
<h1 id="rfc.section.3.1.3">
<a href="#rfc.section.3.1.3">3.1.3.</a> <a href="#response-headers" id="response-headers">Response headers</a>
</h1>
<p id="rfc.section.3.1.3.p.1">Resources should include their HTTP response headers, like <samp>content-type</samp>, <samp>content-encoding</samp>, <samp>expires</samp>, <samp>content-security-policy</samp>, etc.</p>
<p id="rfc.section.3.1.3.p.2">This requires an extension to <a href="#ZIP" class="xref">[ZIP]</a>: we&#8217;d need something like <a href="#JAR" class="xref">[JAR]</a>&#8217;s <samp>META-INF</samp> directory to hold extra metadata beyond the resource&#8217;s body.</p>
<h1 id="rfc.section.3.1.4">
<a href="#rfc.section.3.1.4">3.1.4.</a> <a href="#signing" id="signing">Signing as an origin</a>
</h1>
<p id="rfc.section.3.1.4.p.1">Resources within a package are provably from an entity with the ability to serve HTTPS requests for those resources&#8217; origin <a href="#RFC6454" class="xref">[RFC6454]</a>.</p>
<p id="rfc.section.3.1.4.p.2">Resources within a package are provably from an entity with the ability to serve HTTPS requests for those resources&#8217; origin <a href="#RFC6454" class="xref">[RFC6454]</a>.</p>
<p id="rfc.section.3.1.4.p.3">Note that previous attempts to sign HTTP messages (<a href="#I-D.thomson-http-content-signature" class="xref">[I-D.thomson-http-content-signature]</a>, <a href="#I-D.burke-content-signature" class="xref">[I-D.burke-content-signature]</a>, and <a href="#I-D.cavage-http-signatures" class="xref">[I-D.cavage-http-signatures]</a>) omit a description of how a client should use a signature to prove that a resource comes from a particular origin, and they&#8217;re probably not usable for that purpose.</p>
<p id="rfc.section.3.1.4.p.4">This would require an extension to the <a href="#ZIP" class="xref">[ZIP]</a> format, similar to <a href="#JAR" class="xref">[JAR]</a>&#8217;s signatures.</p>
<p id="rfc.section.3.1.4.p.5">In any cryptographic system, the specification is responsible to make correct implementations easier to deploy than incorrect implementations (<a href="#easy-implementation" class="xref">Section 3.1.12</a>).</p>
<h1 id="rfc.section.3.1.5">
<a href="#rfc.section.3.1.5">3.1.5.</a> <a href="#random-access" id="random-access">Random access</a>
</h1>
<p id="rfc.section.3.1.5.p.1">When a package is stored on disk, the browser can access arbitrary resources without a linear scan.</p>
<p><a href="#MHTML" class="xref">[MHTML]</a> would need to be extended with an index of the byte offsets of each contained resource.</p>
<h1 id="rfc.section.3.1.6">
<a href="#rfc.section.3.1.6">3.1.6.</a> <a href="#multiple-origins" id="multiple-origins">Resources from multiple origins in a package</a>
</h1>
<p id="rfc.section.3.1.6.p.1">A package from origin <samp>A</samp> can contain resources from origin <samp>B</samp> authenticated at the same level as those from <samp>A</samp>.</p>
<h1 id="rfc.section.3.1.7">
<a href="#rfc.section.3.1.7">3.1.7.</a> <a href="#crypto-agility" id="crypto-agility">Cryptographic agility</a>
</h1>
<p id="rfc.section.3.1.7.p.1">Obsolete cryptographic algorithms can be replaced.</p>
<p id="rfc.section.3.1.7.p.2">Planning to upgrade the cryptography also means we should include some way to know when it&#8217;s safe to remove old cryptography (<a href="#crypto-removal" class="xref">Section 3.2.5</a>).</p>
<h1 id="rfc.section.3.1.8">
<a href="#rfc.section.3.1.8">3.1.8.</a> <a href="#unsigned-content" id="unsigned-content">Unsigned content</a>
</h1>
<p id="rfc.section.3.1.8.p.1">Alex can create their own package without a CA-signed certificate, and Bailey can view the content of the package.</p>
<h1 id="rfc.section.3.1.9">
<a href="#rfc.section.3.1.9">3.1.9.</a> <a href="#revocation" id="revocation">Certificate revocation</a>
</h1>
<p id="rfc.section.3.1.9.p.1">When a package is signed by a revoked certificate, online browsers can detect this reasonably quickly.</p>
<h1 id="rfc.section.3.1.10">
<a href="#rfc.section.3.1.10">3.1.10.</a> <a href="#no-downgrades" id="no-downgrades">Downgrade prevention</a>
</h1>
<p id="rfc.section.3.1.10.p.1">Attackers can&#8217;t cause a browser to trust an older, vulnerable version of a package after the browser has seen a newer version.</p>
<h1 id="rfc.section.3.1.11">
<a href="#rfc.section.3.1.11">3.1.11.</a> <a href="#metadata" id="metadata">Metadata</a>
</h1>
<p id="rfc.section.3.1.11.p.1">Metadata like that found in the W3C&#8217;s Application Manifest <a href="#W3C.WD-appmanifest-20170828" class="xref">[W3C.WD-appmanifest-20170828]</a> can help a client know how to load and display a package.</p>
<h1 id="rfc.section.3.1.12">
<a href="#rfc.section.3.1.12">3.1.12.</a> <a href="#easy-implementation" id="easy-implementation">Implementations are hard to get wrong</a>
</h1>
<p id="rfc.section.3.1.12.p.1">The design should incorporate aspects that tend to cause incorrect implementations to get noticed quickly, and avoid aspects that are easy to implement incorrectly. For example:</p>
<p></p>

<ul>
<li>Explicitly specifying a cryptographic algorithm identifier in <a href="#RFC7515" class="xref">[RFC7515]</a> made it easy for implementations to trust that algorithm, which <a href="https://paragonie.com/blog/2017/03/jwt-json-web-tokens-is-bad-standard-that-everyone-should-avoid">caused vulnerabilities</a>.</li>
<li>
<a href="#ZIP" class="xref">[ZIP]</a>&#8217;s duplicate specification of filenames makes it easy for implementations to <a href="https://nakedsecurity.sophos.com/2013/07/10/anatomy-of-a-security-hole-googles-android-master-key-debacle-explained/">check the signature of one copy but use the other</a>.</li>
<li>Following <a href="https://blog.gerv.net/2016/09/introducing-deliberate-protocol-errors-langleys-law/">Langley&#8217;s Law</a> when possible makes it hard to deploy incorrect implementations.</li>
</ul>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#nice-to-have-reqs" id="nice-to-have-reqs">Nice to have</a>
</h1>
<h1 id="rfc.section.3.2.1">
<a href="#rfc.section.3.2.1">3.2.1.</a> <a href="#streamed-loading" id="streamed-loading">Streamed loading</a>
</h1>
<p id="rfc.section.3.2.1.p.1">The browser can load a package as it downloads.</p>
<p id="rfc.section.3.2.1.p.2">This conflicts with ZIP, since ZIP&#8217;s index is at the end.</p>
<h1 id="rfc.section.3.2.2">
<a href="#rfc.section.3.2.2">3.2.2.</a> <a href="#additional-signatures" id="additional-signatures">Additional signatures</a>
</h1>
<p id="rfc.section.3.2.2.p.1">Third-parties can vouch for packages by signing them.</p>
<h1 id="rfc.section.3.2.3">
<a href="#rfc.section.3.2.3">3.2.3.</a> <a href="#binary" id="binary">Binary</a>
</h1>
<p id="rfc.section.3.2.3.p.1">The format is identified as binary by tools that might try to &#8220;fix&#8221; line endings.</p>
<p id="rfc.section.3.2.3.p.2">This conflicts with using an <a href="#MHTML" class="xref">[MHTML]</a>-based format.</p>
<h1 id="rfc.section.3.2.4">
<a href="#rfc.section.3.2.4">3.2.4.</a> <a href="#deduplication" id="deduplication">Deduplication of diamond dependencies</a>
</h1>
<p id="rfc.section.3.2.4.p.1">Nested packages that have multiple dependency routes to the same sub-package, can be transmitted and stored with only one copy of that sub-package.</p>
<h1 id="rfc.section.3.2.5">
<a href="#rfc.section.3.2.5">3.2.5.</a> <a href="#crypto-removal" id="crypto-removal">Old crypto can be removed</a>
</h1>
<p id="rfc.section.3.2.5.p.1">The ecosystem can identify when an obsolete cryptographic algorithm is no longer needed and can be removed.</p>
<h1 id="rfc.section.3.2.6">
<a href="#rfc.section.3.2.6">3.2.6.</a> <a href="#transfer-compression" id="transfer-compression">Compress transfers</a>
</h1>
<p id="rfc.section.3.2.6.p.1">Transferring a package over the network takes as few bytes as possible. This is an easier problem than <a href="#stored-compression" class="xref">Compress stored packages</a> since it doesn&#8217;t have to preserve <a href="#random-access" class="xref">Random access</a>.</p>
<h1 id="rfc.section.3.2.7">
<a href="#rfc.section.3.2.7">3.2.7.</a> <a href="#stored-compression" id="stored-compression">Compress stored packages</a>
</h1>
<p id="rfc.section.3.2.7.p.1">Storing a package on disk takes as few bytes as possible.</p>
<h1 id="rfc.section.3.2.8">
<a href="#rfc.section.3.2.8">3.2.8.</a> <a href="#subsetting" id="subsetting">Subsetting and reordering</a>
</h1>
<p id="rfc.section.3.2.8.p.1">Resources can be removed from and reordered within a package, without breaking <a href="#signing" class="xref">signatures</a>.</p>
<h1 id="rfc.section.3.2.9">
<a href="#rfc.section.3.2.9">3.2.9.</a> <a href="#packaged-validity" id="packaged-validity">Packaged validity information</a>
</h1>
<p><a href="#revocation" class="xref">Certificate revocation</a> and <a href="#no-downgrades" class="xref">Downgrade prevention</a> information can itself be packaged or included in other packages.</p>
<h1 id="rfc.section.3.2.10">
<a href="#rfc.section.3.2.10">3.2.10.</a> <a href="#existing-certs" id="existing-certs">Signing uses existing TLS certificates</a>
</h1>
<p id="rfc.section.3.2.10.p.1">A &#8220;normal&#8221; TLS certificate can be used for signing packages. Avoiding extra requirements like &#8220;code signing&#8221; certificates makes packaging more accessible to all sites.</p>
<h1 id="rfc.section.3.2.11">
<a href="#rfc.section.3.2.11">3.2.11.</a> <a href="#external-dependencies" id="external-dependencies">External dependencies</a>
</h1>
<p id="rfc.section.3.2.11.p.1">Sub-packages can be &#8220;external&#8221; to the main package, meaning the browser will need to either fetch them separately or already have them.  (<a href="https://github.com/WICG/webpackage/issues/35">#35, App Installer Story</a>)</p>
<h1 id="rfc.section.3.2.12">
<a href="#rfc.section.3.2.12">3.2.12.</a> <a href="#trailing-length" id="trailing-length">Trailing length</a>
</h1>
<p id="rfc.section.3.2.12.p.1">The package&#8217;s length in bytes appears a fixed offset from the end of the package.</p>
<p id="rfc.section.3.2.12.p.2">This conflicts with <a href="#MHTML" class="xref">[MHTML]</a>.</p>
<h1 id="rfc.section.3.2.13">
<a href="#rfc.section.3.2.13">3.2.13.</a> <a href="#timeshifting" id="timeshifting">Time-shifting execution</a>
</h1>
<p id="rfc.section.3.2.13.p.1">In some unsigned packages, Javascript time-telling functions should return the timestamp of the package, rather than the true current time.</p>
<p id="rfc.section.3.2.13.p.2">We should explore if this has security implications.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#non-goals" id="non-goals">Non-goals</a>
</h1>
<p id="rfc.section.4.p.1">Some features often come along with packaging and signing, and it&#8217;s important to explicitly note that they don&#8217;t appear in the list of <a href="#requirements" class="xref">Requirements</a>.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#confidential" id="confidential">Store confidential data</a>
</h1>
<p id="rfc.section.4.1.p.1">Packages are designed to hold public information and to be shared to people with whom the original publisher never has an interactive connection. In that situation, there&#8217;s no way to keep the contents confidential: even if they were encrypted, to make the data public, anyone would have to be able to get the decryption key.</p>
<p id="rfc.section.4.1.p.2">It&#8217;s possible to maintain something similar to confidentiality for non-public packaged data, but doing so complicates the format design and can give users a false sense of security.</p>
<p id="rfc.section.4.1.p.3">We believe we&#8217;ll cause fewer privacy breaches if we omit any mechanism for encrypting data, than if we include something and try to teach people when it&#8217;s unsafe to use.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#streamed-generation" id="streamed-generation">Generate packages on the fly</a>
</h1>
<p id="rfc.section.4.2.p.1">See discussion at <a href="https://github.com/WICG/webpackage/issues/6#issuecomment-275746125">WICG/webpackage#6</a>.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#non-origin-identity" id="non-origin-identity">Non-origin identity</a>
</h1>
<p id="rfc.section.4.3.p.1">A package can be primarily identified as coming from something other than a <a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">Web Origin</a>.</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#drm" id="drm">DRM</a>
</h1>
<p id="rfc.section.4.4.p.1">Special support for blocking access to downloaded content based on licensing. Note that DRM systems can be shipped inside the package even if the packaging format doesn&#8217;t specifically support them.</p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> <a href="#push-replacement" id="push-replacement">Ergonomic replacement for HTTP/2 PUSH</a>
</h1>
<p id="rfc.section.4.5.p.1">HTTP/2 PUSH (<a href="#RFC7540" class="xref">[RFC7540]</a>, section 8.2) is hard for developers to configure, and an explicit package format might be easier. However, experts in this area believe we should focus on improving PUSH directly instead of routing around it with a bundling format.</p>
<p id="rfc.section.4.5.p.2">Trying to bundle resources in order to speed up page loads has a long history, including <a href="https://www.mnot.net/blog/2010/02/18/resource_packages">Resource Packages</a> from 2010 and the <a href="https://w3ctag.github.io/packaging-on-the-web/">W3C TAG&#8217;s packaging proposal</a> from 2015.</p>
<p id="rfc.section.4.5.p.3">However, the HTTPWG is doing a lot of work to let servers optimize the PUSHed data, and packaging would either have to re-do that or accept lower performance.  For example:</p>
<p></p>

<ul>
<li>
<a href="#I-D.vkrasnov-h2-compression-dictionaries" class="xref">[I-D.vkrasnov-h2-compression-dictionaries]</a> should allow individual small resources to be compressed as well as they would be in a bundle.</li>
<li>
<a href="#I-D.ietf-httpbis-cache-digest" class="xref">[I-D.ietf-httpbis-cache-digest]</a> tells the server which resources it doesn&#8217;t need to PUSH.</li>
</ul>
<p id="rfc.section.4.5.p.5">Associated requirements:</p>
<p></p>

<ul>
<li>
<a href="#streamed-loading" class="xref">Streamed loading</a>: If the whole package has to be downloaded before the browser can load a piece, this will definitely be slower than PUSH.</li>
<li>
<a href="#transfer-compression" class="xref">Compress transfers</a>: Keep up with <a href="#I-D.vkrasnov-h2-compression-dictionaries" class="xref">[I-D.vkrasnov-h2-compression-dictionaries]</a>.</li>
<li>
<a href="#urls" class="xref">Indexed by URL</a>: Resources on the web are addressed by URL.</li>
<li>
<a href="#request-headers" class="xref">Request headers</a>: <a href="http://httpwg.org/specs/rfc7540.html#PUSH_PROMISE">PUSH_PROMISE</a> (<a href="#RFC7540" class="xref">[RFC7540]</a>, section 6.6) includes request headers.</li>
<li>
<a href="#response-headers" class="xref">Response headers</a>: PUSHed resources include their response headers.</li>
</ul>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.5.p.1">The security considerations will depend on the solution designed to satisfy the above requirements. See <a href="#I-D.yasskin-dispatch-web-packaging" class="xref">[I-D.yasskin-dispatch-web-packaging]</a> for one possible set of security considerations.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.6.p.1">This document has no actions for IANA.</p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.burke-content-signature">[I-D.burke-content-signature]</b></td>
<td class="top">
<a>Burke, B.</a>, "<a href="https://tools.ietf.org/html/draft-burke-content-signature-00">HTTP Header for digital signatures</a>", Internet-Draft draft-burke-content-signature-00, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.cavage-http-signatures">[I-D.cavage-http-signatures]</b></td>
<td class="top">
<a>Cavage, M.</a> and <a>M. Sporny</a>, "<a href="https://tools.ietf.org/html/draft-cavage-http-signatures-10">Signing HTTP Messages</a>", Internet-Draft draft-cavage-http-signatures-10, May 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-httpbis-cache-digest">[I-D.ietf-httpbis-cache-digest]</b></td>
<td class="top">
<a>Oku, K.</a> and <a>Y. Weiss</a>, "<a href="https://tools.ietf.org/html/draft-ietf-httpbis-cache-digest-04">Cache Digests for HTTP/2</a>", Internet-Draft draft-ietf-httpbis-cache-digest-04, April 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-httpbis-http2-secondary-certs">[I-D.ietf-httpbis-http2-secondary-certs]</b></td>
<td class="top">
<a>Bishop, M.</a>, <a>Sullivan, N.</a> and <a>M. Thomson</a>, "<a href="https://tools.ietf.org/html/draft-ietf-httpbis-http2-secondary-certs-01">Secondary Certificate Authentication in HTTP/2</a>", Internet-Draft draft-ietf-httpbis-http2-secondary-certs-01, May 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.thomson-http-content-signature">[I-D.thomson-http-content-signature]</b></td>
<td class="top">
<a>Thomson, M.</a>, "<a href="https://tools.ietf.org/html/draft-thomson-http-content-signature-00">Content-Signature Header Field for HTTP</a>", Internet-Draft draft-thomson-http-content-signature-00, July 2015.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.vkrasnov-h2-compression-dictionaries">[I-D.vkrasnov-h2-compression-dictionaries]</b></td>
<td class="top">
<a>Krasnov, V.</a> and <a>Y. Weiss</a>, "<a href="https://tools.ietf.org/html/draft-vkrasnov-h2-compression-dictionaries-03">Compression Dictionaries for HTTP/2</a>", Internet-Draft draft-vkrasnov-h2-compression-dictionaries-03, March 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.yasskin-dispatch-web-packaging">[I-D.yasskin-dispatch-web-packaging]</b></td>
<td class="top">
<a>Yasskin, J.</a>, "<a href="https://tools.ietf.org/html/draft-yasskin-dispatch-web-packaging-00">Web Packaging</a>", Internet-Draft draft-yasskin-dispatch-web-packaging-00, June 2017.</td>
</tr>
<tr>
<td class="reference"><b id="ISO28500">[ISO28500]</b></td>
<td class="top">"<a href="https://www.iso.org/standard/68004.html">WARC file format</a>", ISO 28500:2017, 2017.</td>
</tr>
<tr>
<td class="reference"><b id="JAR">[JAR]</b></td>
<td class="top">"<a href="https://docs.oracle.com/javase/7/docs/technotes/guides/jar/jar.html">JAR File Specification</a>", 2014.</td>
</tr>
<tr>
<td class="reference"><b id="MHTML">[MHTML]</b></td>
<td class="top">
<a>Palme, J.</a>, <a>Hopmann, A.</a> and <a>N. Shelness</a>, "<a href="https://tools.ietf.org/html/rfc2557">MIME Encapsulation of Aggregate Documents, such as HTML (MHTML)</a>", RFC 2557, DOI 10.17487/RFC2557, March 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6454">[RFC6454]</b></td>
<td class="top">
<a>Barth, A.</a>, "<a href="https://tools.ietf.org/html/rfc6454">The Web Origin Concept</a>", RFC 6454, DOI 10.17487/RFC6454, December 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6962">[RFC6962]</b></td>
<td class="top">
<a>Laurie, B.</a>, <a>Langley, A.</a> and <a>E. Kasper</a>, "<a href="https://tools.ietf.org/html/rfc6962">Certificate Transparency</a>", RFC 6962, DOI 10.17487/RFC6962, June 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7515">[RFC7515]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="https://tools.ietf.org/html/rfc7515">JSON Web Signature (JWS)</a>", RFC 7515, DOI 10.17487/RFC7515, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7540">[RFC7540]</b></td>
<td class="top">
<a>Belshe, M.</a>, <a>Peon, R.</a> and <a>M. Thomson</a>, "<a href="https://tools.ietf.org/html/rfc7540">Hypertext Transfer Protocol Version 2 (HTTP/2)</a>", RFC 7540, DOI 10.17487/RFC7540, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="ServiceWorkers">[ServiceWorkers]</b></td>
<td class="top">
<a>Russell, A.</a>, <a>Song, J.</a>, <a>Archibald, J.</a> and <a>M. Kruisselbrink</a>, "<a href="https://www.w3.org/TR/2016/WD-service-workers-1-20161011">Service Workers 1</a>", World Wide Web Consortium WD WD-service-workers-1-20161011, October 2016.</td>
</tr>
<tr>
<td class="reference"><b id="W3C.WD-appmanifest-20170828">[W3C.WD-appmanifest-20170828]</b></td>
<td class="top">
<a>Caceres, M.</a>, <a>Christiansen, K.</a>, <a>Lamouri, M.</a>, <a>Kostiainen, A.</a> and <a>R. Dolin</a>, "<a href="https://www.w3.org/TR/2017/WD-appmanifest-20170828">Web App Manifest</a>", World Wide Web Consortium WD WD-appmanifest-20170828, August 2017.</td>
</tr>
<tr>
<td class="reference"><b id="ZIP">[ZIP]</b></td>
<td class="top">"<a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT">APPNOTE.TXT - .ZIP File Format Specification</a>", October 2014.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.A.p.1">Thanks to Yoav Weiss for the Subresource bundling use case and discussions about content distributors.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jeffrey Yasskin</span> 
	  <span class="n hidden">
		<span class="family-name">Yasskin</span>
	  </span>
	</span>
	<span class="org vcardline">Google</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jyasskin@chromium.org">jyasskin@chromium.org</a></span>

  </address>
</div>

</body>
</html>
